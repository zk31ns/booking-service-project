name: Notify Changes Requested in Telegram

on:
  pull_request_review:
    types: [submitted]

jobs:
  notify:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check review action
        id: check_review
        run: |
          if [ "${{ github.event.review.state }}" == "changes_requested" ]; then
            echo "changes_requested=true" >> $GITHUB_OUTPUT
          fi
      
      - name: Send Telegram notification
        if: steps.check_review.outputs.changes_requested == 'true'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            ‚ö†Ô∏è **–ó–∞–ø—Ä–æ—Å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É PR!**
            
            üìå PR: #${{ github.event.pull_request.number }}
            üìù –ù–∞–∑–≤–∞–Ω–∏–µ: ${{ github.event.pull_request.title }}
            üë§ –ê–≤—Ç–æ—Ä: @${{ github.event.pull_request.user.login }}
            üëÄ –†–µ—Ü–µ–Ω–∑–µ–Ω—Ç: @${{ github.event.review.user.login }}
            
            üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:
            ${{ github.event.review.body }}
            
            üîó –°—Å—ã–ª–∫–∞: ${{ github.event.pull_request.html_url }}
            
            ‚è∞ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–Ω–µ—Å–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          format: html
